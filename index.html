<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Documentation</title>
<link rel="icon" href="documentation.png" type="image/png">

<!-- Highlight.js Themes (8 preload) -->
<link id="hljs-atom-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
<link id="hljs-atom-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css" disabled>
<link id="hljs-github" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" disabled>
<link id="hljs-github-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" disabled>
<link id="hljs-dracula" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/dracula.min.css" disabled>
<link id="hljs-monokai" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/monokai.min.css" disabled>
<link id="hljs-solarized-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/solarized-light.min.css" disabled>
<link id="hljs-solarized-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/solarized-dark.min.css" disabled>

<style>
  html, body { margin:0; padding:0; font-family:system-ui, sans-serif; }
  body { display:flex; flex-direction:column; min-height:100vh; background:#f5f5f5; color:#24292e; }

  /* Scrollbar styles (light + dark mode) */
  ::-webkit-scrollbar { width: 10px; height: 10px; }
  ::-webkit-scrollbar-track { background: #f1f1f1; }
  ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 6px; }
  ::-webkit-scrollbar-thumb:hover { background: #a0a0a0; }
  body.dark-mode ::-webkit-scrollbar-track { background: #2c2c2c; }
  body.dark-mode ::-webkit-scrollbar-thumb { background: #555; }
  body.dark-mode ::-webkit-scrollbar-thumb:hover { background: #777; }
  * { scrollbar-width: thin; scrollbar-color: #c1c1c1 #f1f1f1; }
  body.dark-mode * { scrollbar-color: #555 #2c2c2c; }

  /* Topbar */
  header.topbar {
    background:#24292e; color:white; display:flex;
    justify-content:space-between; align-items:center;
    padding:0 1rem; height:4rem; position:sticky; top:0; z-index:100;
  }
  header.topbar .logo { font-weight:700; font-size:1.2rem; user-select:none; }
  nav.topbar-nav { display:flex; gap:1rem; }
  nav.topbar-nav a { color:#c9d1d9; text-decoration:none; font-weight:500; padding:0.25rem 0.5rem; border-radius:4px; }
  nav.topbar-nav a:hover { background:#444c56; color:white; }

  .topbar-actions { display:flex; gap:0.5rem; align-items:center; }
  .mode-toggle, .theme-selector {
    background:#eaecef; border:1px solid #ccc;
    border-radius:4px; padding:0.3rem 0.6rem;
    cursor:pointer; font-size:0.9rem;
  }

  /* Mobile nav */
  .nav-toggle-btn {
    display:none; background:#444c56; color:white; border:none;
    padding:0.3rem 0.6rem; border-radius:4px; cursor:pointer;
  }
  .nav-toggle-btn:hover { background:#57606a; }
  .menu-overlay {
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.3); opacity:0; pointer-events:none;
    transition:opacity 0.3s ease; z-index:900;
  }
  .menu-overlay.active { opacity:1; pointer-events:auto; }
  .menu-popup {
    position:fixed; top:4rem; right:0; width:80%; max-width:300px;
    height:calc(100vh - 4rem); background:#fff; border-left:1px solid #ddd;
    transform:translateX(100%); transition:transform 0.3s ease; z-index:1000;
    display:flex; flex-direction:column; padding:1rem;
    overflow-y:auto;
  }
  .menu-popup.open { transform:translateX(0); }
  .menu-popup a {
    margin-bottom:1rem; color:#0366d6; text-decoration:none;
    font-size:1.1rem; padding:0.5rem 0;
  }
  .menu-popup a:hover { text-decoration:underline; }
  .menu-popup .mobile-controls {
    margin-top:1.5rem; display:flex; flex-direction:column; gap:1rem;
  }
  .menu-popup select, .menu-popup button {
    padding:0.6rem; font-size:1rem; border-radius:6px; border:1px solid #ccc;
  }

  /* Content */
  .main-container { flex:1; max-width:1200px; margin:1rem auto; width:100%; }
  .markdown-body {
    background:#fff; padding:1rem; border-radius:8px;
    box-shadow:0 0 10px rgba(0,0,0,0.05);
    overflow-x:auto;
  }
  .code-block-wrapper { position:relative; margin:1.5em 0; }
  .markdown-body pre { margin:0; overflow:auto; }
  .markdown-body pre code {
    display:block; padding:1em 3.5em 1em 1em; border-radius:6px;
    font-family:"Fira Code", monospace; font-size:0.95em;
    background:#f6f8fa; color:#24292e;
  }

  /* Floating copy button */
  .floating-copy-btn {
    position:fixed; top:-9999px; left:-9999px; z-index:1100;
    padding:0.35rem 0.6rem; font-size:0.8rem;
    border-radius:6px; cursor:pointer; background:#eaecef; border:none;
    box-shadow:0 2px 6px rgba(0,0,0,0.15);
    opacity:0; pointer-events:none;
    transition:opacity 0.15s ease;
  }
  .floating-copy-btn.show, .floating-copy-btn.always-visible { opacity:1; pointer-events:auto; }
  .floating-copy-btn.copied { background:#28a745; color:white; }

  /* Footer */
  footer { background:#1e1e1e; text-align:center; padding:20px; margin-top:auto; }
  footer .github-link {
    display:inline-block; padding:12px 28px; background:#2da44e; color:white;
    font-size:1.1rem; font-weight:600; text-decoration:none; border-radius:8px;
    transition:background 0.2s, transform 0.1s;
  }
  footer .github-link:hover { background:#2c974b; transform:translateY(-2px); }

  /* Dark mode */
  body.dark-mode { background:#121212; color:#e0e0e0; }
  body.dark-mode .markdown-body { background:#1c1c1c; }
  body.dark-mode .markdown-body pre code { background:#2c2c2c; color:#f5f5f5; }
  body.dark-mode .floating-copy-btn { background:#444c56; color:#e0e0e0; }
  body.dark-mode .floating-copy-btn.copied { background:#28a745; color:white; }
  body.dark-mode .menu-popup { background:#1c1c1c; border-color:#333; }
  body.dark-mode .menu-popup a { color:#58a6ff; }
  body.dark-mode .menu-popup select, 
  body.dark-mode .menu-popup button { background:#2c2c2c; color:#f5f5f5; border-color:#444; }

  /* Responsive */
  @media (max-width: 768px) {
    nav.topbar-nav { display:none; }
    .nav-toggle-btn { display:inline-block; }
    .theme-selector, .mode-toggle { display:none; }
  }
</style>
</head>
<body>

<header class="topbar">
  <div class="logo">Document Creator</div>
  <nav class="topbar-nav">
    <a href="#" id="homeBtn" class="active-tab">Home</a>
    <a href="#" data-md="about.md" class="page-link">About</a>
  </nav>
  <div class="topbar-actions">
    <button class="nav-toggle-btn" id="navToggle">☰</button>
    <select id="themeSelector" class="theme-selector">
      <option value="hljs-atom-light">Atom One Light</option>
      <option value="hljs-atom-dark">Atom One Dark</option>
      <option value="hljs-github">GitHub</option>
      <option value="hljs-github-dark">GitHub Dark</option>
      <option value="hljs-dracula">Dracula</option>
      <option value="hljs-monokai">Monokai</option>
      <option value="hljs-solarized-light">Solarized Light</option>
      <option value="hljs-solarized-dark">Solarized Dark</option>
    </select>
    <button class="mode-toggle" id="modeToggle">Dark Mode</button>
  </div>
</header>

<div class="main-container">
  <div class="markdown-body" id="content">Loading markdown...</div>
</div>

<div class="menu-overlay" id="menuOverlay"></div>
<div class="menu-popup" id="menuPopup"></div>

<footer>
  <a href="https://github.com/speedetoon/test" target="_blank" rel="noopener noreferrer" class="github-link">
    View this project on GitHub →
  </a>
</footer>

<button id="floatingCopyBtn" class="floating-copy-btn">Copy</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/lua.min.js"></script>

<script>
(() => {
  const floatingBtn = document.getElementById('floatingCopyBtn');
  const menuPopup = document.getElementById('menuPopup');
  const menuOverlay = document.getElementById('menuOverlay');
  const navToggle = document.getElementById('navToggle');
  const themeSelector = document.getElementById('themeSelector');
  const modeToggle = document.getElementById('modeToggle');
  let activeWrapper = null, activeCodeEl = null, overBtn = false;

  function isMobile() {
    return window.innerWidth <= 768 || ('ontouchstart' in window);
  }

  /* Mobile nav */
  function openMenu() {
    menuPopup.classList.add('open');
    menuOverlay.classList.add('active');
    updateMenuLinks();

    if (!document.getElementById('mobileThemeSelector')) {
      const controls = document.createElement('div');
      controls.className = 'mobile-controls';

      const mobileTheme = themeSelector.cloneNode(true);
      mobileTheme.id = 'mobileThemeSelector';
      mobileTheme.value = themeSelector.value;
      mobileTheme.addEventListener('change', e => {
        themeSelector.value = e.target.value;
        setTheme(e.target.value);
      });

      const darkBtn = document.createElement('button');
      darkBtn.textContent = modeToggle.textContent;
      darkBtn.onclick = () => modeToggle.click();

      controls.appendChild(mobileTheme);
      controls.appendChild(darkBtn);
      menuPopup.appendChild(controls);
    }
  }
  function closeMenu() {
    menuPopup.classList.remove('open');
    menuOverlay.classList.remove('active');
  }
  navToggle.addEventListener('click', openMenu);
  menuOverlay.addEventListener('click', closeMenu);

  function updateMenuLinks() {
    menuPopup.innerHTML = '';
    document.querySelectorAll('header.topbar nav.topbar-nav a').forEach(a => {
      const link = document.createElement('a');
      link.href = a.href;
      link.textContent = a.textContent;
      link.onclick = e => {
        e.preventDefault();
        closeMenu();
        a.click();
      };
      menuPopup.appendChild(link);
    });
  }

  /* Copy logic */
  floatingBtn.addEventListener('click', async () => {
    if (!activeCodeEl) return;
    try {
      await navigator.clipboard.writeText(activeCodeEl.textContent);
      floatingBtn.classList.add('copied');
      floatingBtn.textContent = 'Copied!';
      setTimeout(() => {
        floatingBtn.classList.remove('copied');
        floatingBtn.textContent = 'Copy';
      }, 1500);
    } catch {}
  });
  floatingBtn.addEventListener('mouseenter', () => overBtn = true);
  floatingBtn.addEventListener('mouseleave', () => overBtn = false);

  function setActive(wrapper, code) {
    activeWrapper = wrapper;
    activeCodeEl = code;
    floatingBtn.classList.add(isMobile() ? 'always-visible' : 'show');
    positionBtn();
  }

  function positionBtn() {
    if (!activeWrapper) return;
    const rect = activeWrapper.getBoundingClientRect();
    const btnRect = floatingBtn.getBoundingClientRect();
    const vw = window.innerWidth, vh = window.innerHeight;
    const topbarHeight = document.querySelector('header.topbar').offsetHeight;

    if (rect.bottom <= 0 || rect.top >= vh) {
      floatingBtn.classList.remove('show', 'always-visible');
      return;
    }

    const left = Math.min(rect.right, vw) - btnRect.width - 8;
    const minTop = topbarHeight + 8;
    const desiredTop = Math.max(rect.top, minTop) + 8;

    floatingBtn.style.left = left + 'px';
    floatingBtn.style.top = desiredTop + 'px';
  }

  /* Markdown */
  function renderMarkdown(mdFile) {
    fetch(mdFile + '?cache=' + Date.now())
      .then(r => r.text())
      .then(md => {
        const container = document.getElementById('content');
        container.innerHTML = marked.parse(md);
        container.querySelectorAll('pre > code').forEach(code => {
          const pre = code.parentElement;
          const wrap = document.createElement('div');
          wrap.className = 'code-block-wrapper';
          pre.parentElement.insertBefore(wrap, pre);
          wrap.appendChild(pre);
          wrap.addEventListener('mouseenter', () => !isMobile() && setActive(wrap, code));
          wrap.addEventListener('mousemove', () => !isMobile() && setActive(wrap, code));
          wrap.addEventListener('mouseleave', () => { if (!isMobile() && !overBtn) floatingBtn.classList.remove('show'); });
          wrap.addEventListener('touchstart', () => setActive(wrap, code), {passive:true});
        });
        hljs.highlightAll();
        updateMenuLinks();
      });
  }

  /* Dark mode */
  function setMode(dark) {
    document.body.classList.toggle('dark-mode', dark);
    modeToggle.textContent = dark ? 'Light Mode' : 'Dark Mode';
    const mobileBtn = document.querySelector('.mobile-controls button');
    if (mobileBtn) mobileBtn.textContent = modeToggle.textContent;
    localStorage.setItem('mode', dark ? 'dark' : 'light');
  }
  setMode(localStorage.getItem('mode') === 'dark');
  modeToggle.addEventListener('click', () => setMode(!document.body.classList.contains('dark-mode')));

  /* Theme switching */
  function setTheme(themeId) {
    document.querySelectorAll('link[id^="hljs-"]').forEach(l => l.disabled = true);
    const theme = document.getElementById(themeId);
    if (theme) theme.disabled = false;
    localStorage.setItem('hljs-theme', themeId);

    const mobileTheme = document.getElementById('mobileThemeSelector');
    if (mobileTheme) mobileTheme.value = themeId;
  }
  themeSelector.addEventListener('change', e => setTheme(e.target.value));

  const savedTheme = localStorage.getItem('hljs-theme') || 'hljs-atom-light';
  themeSelector.value = savedTheme;
  setTheme(savedTheme);

  /* Nav */
  document.getElementById('homeBtn').addEventListener('click', e => { e.preventDefault(); renderMarkdown('README.md'); });
  document.querySelectorAll('.page-link').forEach(link => link.addEventListener('click', e => { e.preventDefault(); renderMarkdown(link.dataset.md); }));

  /* Events */
  window.addEventListener('scroll', positionBtn, {passive:true});
  window.addEventListener('resize', () => { positionBtn(); updateMenuLinks(); });

  /* Init */
  renderMarkdown('README.md');
})();
</script>
</body>
</html>
