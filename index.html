<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Documentation</title>
<link rel="icon" href="documentation.png" type="image/png">

<link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
<link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">

<style>
  html, body {
    margin:0; padding:0; font-family:system-ui, sans-serif;
    transition: background 0.3s, color 0.3s;
    overflow-x:hidden;
  }
  body {
    display:flex; flex-direction:column; min-height:100vh;
    background:#f5f5f5; color:#24292e;
  }

  /* Topbar */
  header.topbar {
    background:#24292e; color:white; display:flex;
    justify-content:space-between; align-items:center;
    padding:0 2rem; height:5rem; position:sticky; top:0; z-index:100;
    box-shadow:0 2px 4px rgba(0,0,0,0.1);
  }
  header.topbar .logo { font-weight:700; font-size:1.5rem; user-select:none; }
  nav.topbar-nav { display:flex; gap:1.5rem; }
  nav.topbar-nav a {
    color:#c9d1d9; text-decoration:none; font-weight:500;
    font-size:1.1rem; padding:0.25rem 0.5rem; border-radius:4px;
    transition: background 0.2s, color 0.2s;
  }
  nav.topbar-nav a:hover { background:#444c56; color:white; }
  .topbar-actions { display:flex; gap:1rem; align-items:center; }
  .mode-toggle {
    background:#eaecef; border:none; border-radius:4px;
    padding:0.4rem 0.7rem; cursor:pointer; font-weight:bold;
  }

  /* Layout */
  .main-container { display:flex; max-width:1200px; margin:2rem auto; flex:1; gap:2rem; }
  .markdown-body {
    flex:1; background:#fff; padding:2rem; border-radius:8px;
    box-shadow:0 0 10px rgba(0,0,0,0.05);
    transition:background 0.3s, color 0.3s;
    width:100%; box-sizing:border-box; overflow-x:auto;
  }

  /* Code blocks */
  .code-block-wrapper { position:relative; margin:1.5em 0; }
  .markdown-body pre { margin:0; overflow:auto; }
  .markdown-body pre code{
    display:block; border-radius:6px;
    font-family:"Fira Code", monospace;
    font-size:0.95em; line-height:1.5;
    background:#f6f8fa; color:#24292e;
    padding:1em 3.5em 1em 1em; /* extra right padding so button doesn't cover code */
    transition:background 0.3s, color 0.3s;
    white-space:pre; /* preserve formatting; allow horizontal scroll in <pre> */
  }

  /* Floating copy button (fixed to viewport; we position to block's visible corner) */
  .floating-copy-btn{
    position:fixed;
    top:-9999px; left:-9999px;
    z-index:1100;
    padding:0.35rem 0.6rem;
    font-size:0.8rem;
    border-radius:6px;
    cursor:pointer;
    background:#eaecef; color:#24292e; border:none;
    box-shadow:0 2px 6px rgba(0,0,0,0.15);
    opacity:0; pointer-events:none;
    transition:opacity 0.15s ease, transform 0.05s ease;
  }
  .floating-copy-btn.show { opacity:1; pointer-events:auto; }
  .floating-copy-btn.always-visible { opacity:1 !important; pointer-events:auto !important; }
  .floating-copy-btn:hover { background:#d0d7de; }
  .floating-copy-btn.copied { background:#28a745; color:white; }

  /* Footer */
  footer {
    background:linear-gradient(180deg,#1e1e1e 0%,#121212 100%);
    text-align:center; padding:30px 0; margin-top:auto;
  }
  footer .github-link{
    display:inline-block; padding:12px 28px; background:#2da44e; color:white;
    font-size:1.1rem; font-weight:600; text-decoration:none; border-radius:8px;
    box-shadow:0 4px 6px rgba(0,0,0,0.15);
    transition:background 0.2s, transform 0.1s, box-shadow 0.2s;
  }
  footer .github-link:hover{ background:#2c974b; transform:translateY(-3px); box-shadow:0 6px 10px rgba(0,0,0,0.2); }
  footer .github-link:active{ background:#298e46; transform:translateY(0); box-shadow:0 3px 5px rgba(0,0,0,0.15); }

  /* Dark mode */
  body.dark-mode{ background:#121212; color:#e0e0e0; }
  body.dark-mode .markdown-body{ background:#1c1c1c; color:#e0e0e0; }
  body.dark-mode a{ color:#58a6ff; }
  body.dark-mode .markdown-body pre code{ background:#2c2c2c; color:#f5f5f5; }
  body.dark-mode .floating-copy-btn{ background:#444c56; color:#e0e0e0; }
  body.dark-mode .floating-copy-btn.copied{ background:#28a745; color:white; }
  body.dark-mode footer{ background:linear-gradient(180deg,#0d1117 0%,#010409 100%); }
  body.dark-mode footer .github-link{ background:#238636; color:#f0f6fc; box-shadow:0 4px 6px rgba(0,0,0,0.5); }
  body.dark-mode footer .github-link:hover{ background:#2ea043; box-shadow:0 6px 10px rgba(0,0,0,0.6); }
  body.dark-mode footer .github-link:active{ background:#196c2e; box-shadow:0 3px 5px rgba(0,0,0,0.5); }

  /* Mobile layout */
  @media(max-width:1000px){
    nav.topbar-nav{ display:none; }
    .main-container{ flex-direction:column; margin:1rem; gap:1rem; max-width:100%; }
    .markdown-body{ padding:1rem; max-width:100%; }
  }
</style>
</head>
<body>

<header class="topbar">
  <div class="logo">Document Creator</div>
  <nav class="topbar-nav">
    <a href="#" id="homeBtn" class="active-tab">Home</a>
    <a href="#" data-md="about.md" class="page-link">About</a>
  </nav>
  <div class="topbar-actions">
    <button class="mode-toggle" id="modeToggle">Dark Mode</button>
  </div>
</header>

<div class="main-container">
  <div class="markdown-body" id="content">Loading markdown...</div>
</div>

<footer>
  <a href="https://github.com/speedetoon/test" target="_blank" rel="noopener noreferrer" class="github-link">
    View this project on GitHub â†’
  </a>
</footer>

<!-- One floating copy button reused for all blocks -->
<button id="floatingCopyBtn" class="floating-copy-btn" type="button" aria-label="Copy code">Copy</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/lua.min.js"></script>

<script>
(() => {
  const hljsLight = document.getElementById('hljs-light');
  const hljsDark  = document.getElementById('hljs-dark');
  const floatingBtn = document.getElementById('floatingCopyBtn');

  let activeWrapper = null;
  let activeCodeEl  = null;
  let hideTimer = null;
  let overBtn = false; // prevents hiding when moving from block to button
  let io = null;       // IntersectionObserver for mobile
  const MOBILE_MAX = 1000;

  /* ---------- Markdown render & wrap code blocks ---------- */
  function renderMarkdown(mdFile) {
    fetch(mdFile + '?cache=' + Date.now())
      .then(r => r.ok ? r.text() : Promise.reject(new Error('Failed to load ' + mdFile)))
      .then(markdown => {
        const container = document.getElementById('content');
        container.innerHTML = marked.parse(markdown);

        // Wrap each <pre><code> in a .code-block-wrapper
        const codeBlocks = container.querySelectorAll('pre > code');
        codeBlocks.forEach(code => {
          const pre = code.parentElement;
          const wrapper = document.createElement('div');
          wrapper.className = 'code-block-wrapper';
          pre.parentElement.insertBefore(wrapper, pre);
          wrapper.appendChild(pre);

          // Desktop hover handling
          wrapper.addEventListener('mouseenter', () => setActiveWrapper(wrapper, code, true));
          wrapper.addEventListener('mousemove', () => setActiveWrapper(wrapper, code, true));
          wrapper.addEventListener('mouseleave', onWrapperLeave);

          // Mobile activation by touch
          wrapper.addEventListener('touchstart', () => setActiveWrapper(wrapper, code, false), {passive:true});
        });

        // Syntax highlight
        hljs.highlightAll();

        // Setup/refresh mobile observer
        setupMobileObserver();
      })
      .catch(err => {
        document.getElementById('content').innerHTML =
          `<p style="color:red">Error: ${err.message}</p>`;
      });
  }

  /* ---------- Active block management ---------- */
  function setActiveWrapper(wrapper, codeEl, isHover) {
    activeWrapper = wrapper;
    activeCodeEl  = codeEl;

    // On mobile, always visible; on desktop, show on hover only
    if (isMobile()) {
      floatingBtn.classList.add('always-visible');
      floatingBtn.classList.remove('show');
    } else {
      floatingBtn.classList.add('show');
      floatingBtn.classList.remove('always-visible');
    }

    positionFloatingBtn();
  }

  function onWrapperLeave() {
    if (isMobile()) return; // mobile stays visible while in view (IO controls hide)

    // Delay hide so user can move into the button
    clearTimeout(hideTimer);
    hideTimer = setTimeout(() => {
      if (!overBtn) {
        floatingBtn.classList.remove('show');
        activeWrapper = null;
        activeCodeEl = null;
      }
    }, 120);
  }

  /* ---------- Positioning (relative to viewport) ---------- */
  function positionFloatingBtn() {
    if (!activeWrapper) return;

    const rect = activeWrapper.getBoundingClientRect();
    const btnRect = floatingBtn.getBoundingClientRect();
    const vw = window.innerWidth;
    const vh = window.innerHeight;

    // If active block is off-screen, hide (mobile observer may pick another)
    if (rect.bottom <= 0 || rect.top >= vh || rect.right <= 0 || rect.left >= vw) {
      if (isMobile()) {
        floatingBtn.classList.remove('always-visible');
      } else {
        floatingBtn.classList.remove('show');
      }
      return;
    }

    // Clamp to visible top-right corner of the block
    const visibleRight = Math.min(rect.right, vw);
    const visibleTop   = Math.max(rect.top, 0);

    const left = Math.max(visibleRight - btnRect.width - 8, Math.max(rect.left + 8, 8));
    const top  = Math.min(
      Math.max(visibleTop + 8, 8),
      rect.bottom - btnRect.height - 8
    );

    floatingBtn.style.left = left + 'px';
    floatingBtn.style.top  = top  + 'px';
  }

  /* ---------- Copy logic (with fallback) ---------- */
  async function copyActiveCode() {
    if (!activeCodeEl) return;
    const text = activeCodeEl.textContent;

    try {
      await navigator.clipboard.writeText(text);
      showCopiedState();
    } catch(e) {
      // Fallback for older browsers / blocked clipboard
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.top = '-1000px';
      document.body.appendChild(ta);
      ta.focus(); ta.select();
      try {
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        if (ok) showCopiedState();
      } catch(e2) {
        document.body.removeChild(ta);
      }
    }
  }

  function showCopiedState() {
    const original = floatingBtn.textContent;
    floatingBtn.classList.add('copied');
    floatingBtn.textContent = 'Copied!';
    setTimeout(() => {
      floatingBtn.classList.remove('copied');
      floatingBtn.textContent = original;
    }, 1500);
  }

  /* ---------- Mobile: keep button while a block is in view ---------- */
  function setupMobileObserver() {
    if (io) { io.disconnect(); io = null; }
    if (!isMobile()) return;

    const wrappers = document.querySelectorAll('.code-block-wrapper');
    if (!wrappers.length) {
      floatingBtn.classList.remove('always-visible');
      return;
    }

    const ratios = new Map();
    io = new IntersectionObserver((entries) => {
      entries.forEach(entry => ratios.set(entry.target, entry.intersectionRatio));

      // Pick the most visible block
      let best = null, bestRatio = 0;
      ratios.forEach((ratio, el) => {
        if (ratio > bestRatio) { best = el; bestRatio = ratio; }
      });

      if (best && bestRatio > 0) {
        const codeEl = best.querySelector('pre > code');
        setActiveWrapper(best, codeEl, false);
      } else {
        // none visible -> hide
        floatingBtn.classList.remove('always-visible');
        activeWrapper = null;
        activeCodeEl = null;
      }
    }, { threshold: [0, 0.25, 0.5, 0.75, 1] });

    wrappers.forEach(w => io.observe(w));
  }

  /* ---------- Dark mode ---------- */
  function setMode(isDark) {
    document.body.classList.toggle('dark-mode', isDark);
    hljsLight.disabled = isDark;
    hljsDark.disabled  = !isDark;
    localStorage.setItem('mode', isDark ? 'dark' : 'light');
    document.getElementById('modeToggle').innerText = isDark ? 'Light Mode' : 'Dark Mode';
  }
  const savedMode = localStorage.getItem('mode') === 'dark';
  setMode(savedMode);
  document.getElementById('modeToggle').addEventListener('click', () => {
    setMode(!document.body.classList.contains('dark-mode'));
  });

  /* ---------- Events ---------- */
  // Keep shown when hovering the button itself (desktop)
  floatingBtn.addEventListener('mouseenter', () => { overBtn = true; });
  floatingBtn.addEventListener('mouseleave', () => { overBtn = false; });

  floatingBtn.addEventListener('click', copyActiveCode);
  window.addEventListener('scroll', positionFloatingBtn, {passive:true});
  window.addEventListener('resize', () => { positionFloatingBtn(); setupMobileObserver(); });

  // Nav (optional pages)
  document.getElementById('homeBtn').addEventListener('click', (e) => {
    e.preventDefault();
    document.querySelectorAll('.topbar-nav a').forEach(a => a.classList.remove('active-tab'));
    e.target.classList.add('active-tab');
    renderMarkdown('README.md');
  });
  document.querySelectorAll('.page-link').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      document.querySelectorAll('.topbar-nav a').forEach(a => a.classList.remove('active-tab'));
      link.classList.add('active-tab');
      const mdFile = link.getAttribute('data-md');
      if (mdFile) renderMarkdown(mdFile);
    });
  });

  // Initial load
  renderMarkdown('README.md');

  /* ---------- Helpers ---------- */
  function isMobile(){ return window.innerWidth <= MOBILE_MAX; }
})();
</script>
</body>
</html>
