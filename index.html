<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Documentation</title>
<link rel="icon" href="documentation.png" type="image/png">

<link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
<link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">

<style>
html, body {
  margin:0; padding:0; font-family:system-ui,sans-serif;
  transition: background 0.3s, color 0.3s;
  overflow-x: hidden; 
}
body {
  display:flex; flex-direction:column; min-height:100vh;
  background:#f5f5f5; color:#24292e;
}

header.topbar {
  background:#24292e; color:white; display:flex;
  justify-content:space-between; align-items:center;
  padding:0 2rem; height:5rem; position:sticky;
  top:0; z-index:100; box-shadow:0 2px 4px rgba(0,0,0,0.1);
}
header.topbar .logo { font-weight:700; font-size:1.5rem; user-select:none; }
nav.topbar-nav { display:flex; gap:1.5rem; }
nav.topbar-nav a {
  color:#c9d1d9; text-decoration:none; font-weight:500;
  font-size:1.1rem; padding:0.25rem 0.5rem;
  border-radius:4px; transition: background 0.2s,color 0.2s;
}
nav.topbar-nav a:hover { background:#444c56; color:white; }
.topbar-actions { display:flex; gap:1rem; align-items:center; }
.mode-toggle {
  background:#eaecef; border:none; border-radius:4px;
  padding:0.4rem 0.7rem; cursor:pointer; font-weight:bold;
}

/* Mobile toggle button */
.nav-toggle-btn {
  background:#444c56; color:white; border:none;
  padding:0.3rem 0.6rem; border-radius:4px;
  cursor:pointer; font-size:0.9rem;
}
.nav-toggle-btn:hover { background:#57606a; }

.main-container {
  display:flex; max-width:1200px; margin:2rem auto; flex:1; gap:2rem;
}
.markdown-body {
  flex:1; background:#fff; padding:2rem; border-radius:8px;
  box-shadow:0 0 10px rgba(0,0,0,0.05);
  transition:background 0.3s,color 0.3s;
  width:100%;
  box-sizing:border-box;
  overflow-x:auto;
}
.markdown-body pre {
  white-space:pre; /* keep code formatting; horizontal scroll lives inside wrapper */
  overflow:auto;
  margin:0;
}
.code-block-wrapper {
  position: relative;
  margin: 1.5em 0;
  overflow: auto; /* scroll container for the <pre> */
  border-radius: 6px;
  background: #f6f8fa;
}
/* Add extra right padding so the floating button never covers code text */
.markdown-body pre code {
  display:block; padding:1em 3.5em 1em 1em; /* extra right padding */
  border-radius:6px;
  font-family:"Fira Code", monospace;
  font-size:0.95em; line-height:1.5;
  color:#24292e;
  transition:background 0.3s,color 0.3s;
}

/* Floating copy button that follows scroll but stays in the codeblock corner */
.floating-copy-btn {
  position: fixed; /* follows viewport; we place it at the codeblock's visible corner */
  top: -9999px; left: -9999px; /* hidden offscreen until activated */
  z-index: 1100;
  padding: 0.35rem 0.6rem;
  font-size: 0.8rem;
  border-radius: 6px;
  cursor: pointer;
  background: #eaecef;
  color: #24292e;
  border: none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.15s ease, transform 0.05s ease;
}
.floating-copy-btn.show {
  opacity: 1;
  pointer-events: auto;
}
.floating-copy-btn:hover { background:#d0d7de; }
.floating-copy-btn.copied {
  background:#28a745;
  color:white;
}

/* Mobile popup */
.menu-overlay {
  position: fixed; top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.3);
  opacity: 0; pointer-events: none;
  transition: opacity 0.3s ease;
  z-index: 900;
}
.menu-overlay.active { opacity:1; pointer-events:auto; }

.menu-popup {
  position: fixed; top:5rem; right:0;
  width:80%; max-width:300px;
  height:calc(100vh - 5rem);
  background:#fff; border-left:1px solid #ddd;
  box-shadow:-2px 0 5px rgba(0,0,0,0.2);
  transform:translateX(100%);
  transition: transform 0.3s ease;
  z-index:1000;
  display:flex;
  flex-direction:column;
  padding:1rem;
}
.menu-popup.open { transform:translateX(0); }

/* Popup links stacked vertically */
.menu-popup a {
  display:block;
  margin-bottom:1rem;
  font-size:1.1rem;
  text-decoration:none;
  color:#0366d6;
}
.menu-popup a:hover { text-decoration:underline; }

/* Dark mode */
body.dark-mode { background:#121212; color:#e0e0e0; }
body.dark-mode .markdown-body { background:#1c1c1c; color:#e0e0e0; }
body.dark-mode a { color:#58a6ff; }
body.dark-mode .code-block-wrapper { background:#2c2c2c; }
body.dark-mode .markdown-body pre code { color:#f5f5f5; }
body.dark-mode .floating-copy-btn { background:#444c56; color:#e0e0e0; }
body.dark-mode .floating-copy-btn.copied { background:#28a745; color:white; }
body.dark-mode .menu-popup { background:#1c1c1c; border-color:#333; }
body.dark-mode .menu-popup a { color:#3399ff; }

footer {
  background:linear-gradient(180deg,#1e1e1e 0%,#121212 100%);
  text-align:center; padding:30px 0;
  margin-top:auto;
}

/* GitHub button */
footer .github-link {
  display:inline-block;
  padding:12px 28px;
  background:#2da44e;
  color:white;
  font-size:1.1rem;
  font-weight:600;
  text-decoration:none;
  border-radius:8px;
  box-shadow:0 4px 6px rgba(0,0,0,0.15);
  transition:background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
}
footer .github-link:hover {
  background:#2c974b;
  transform:translateY(-3px);
  box-shadow:0 6px 10px rgba(0,0,0,0.2);
}
footer .github-link:active {
  background:#298e46;
  transform:translateY(0);
  box-shadow:0 3px 5px rgba(0,0,0,0.15);
}

/* ðŸŒ™ Dark Mode GitHub button */
body.dark-mode footer {
  background:linear-gradient(180deg,#0d1117 0%,#010409 100%);
}
body.dark-mode footer .github-link {
  background:#238636;
  color:#f0f6fc;
  box-shadow:0 4px 6px rgba(0,0,0,0.5);
}
body.dark-mode footer .github-link:hover {
  background:#2ea043;
  box-shadow:0 6px 10px rgba(0,0,0,0.6);
}
body.dark-mode footer .github-link:active {
  background:#196c2e;
  box-shadow:0 3px 5px rgba(0,0,0,0.5);
}

/* Responsive adjustments for mobile */
@media(max-width:1000px) {
  nav.topbar-nav { display:none; } /* hide topbar links on mobile */
  .main-container {
    flex-direction: column;
    margin: 1rem;
    gap: 1rem;
    max-width: 100%;
  }
  .markdown-body {
    padding: 1rem;
    max-width: 100%;
  }
}
</style>
</head>
<body>

<header class="topbar">
  <div class="logo">Document Creator</div>
  <nav class="topbar-nav">
    <a href="#" id="homeBtn" class="active-tab">Home</a>
    <a href="#" data-md="about.md" class="page-link">About</a>
  </nav>
  <div class="topbar-actions">
    <button class="mode-toggle" id="modeToggle">Dark Mode</button>
  </div>
</header>

<div class="main-container">
  <div class="markdown-body" id="content">Loading markdown...</div>
</div>

<!-- Mobile overlay & popup -->
<div class="menu-overlay" id="menuOverlay"></div>
<div class="menu-popup" id="menuPopup">
  <div id="mobileTabsContainer"></div>
</div>

<footer>
  <a href="https://github.com/speedetoon/test" target="_blank" rel="noopener noreferrer" class="github-link">
    View this project on GitHub â†’
  </a>
</footer>

<!-- Floating copy button (one instance for all code blocks) -->
<button class="floating-copy-btn" id="floatingCopyBtn" type="button" aria-label="Copy code">Copy</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/lua.min.js"></script>

<script>
const hljsLight = document.getElementById('hljs-light');
const hljsDark = document.getElementById('hljs-dark');
const menuPopup = document.getElementById('menuPopup');
const menuOverlay = document.getElementById('menuOverlay');
const mobileTabsContainer = document.getElementById('mobileTabsContainer');
const floatingBtn = document.getElementById('floatingCopyBtn');

let activeWrapper = null;
let activeCodeEl = null;
let copyResetTimer = null;

/* ------- Markdown rendering & code wrapping ------- */
function renderMarkdown(mdFile) {
  fetch(mdFile + '?cache=' + Date.now())
    .then(r => r.ok ? r.text() : Promise.reject())
    .catch(() => `# Error\n\nCould not load ${mdFile}`)
    .then(markdown => {
      const container = document.getElementById('content');
      container.innerHTML = marked.parse(markdown);

      // Wrap code blocks
      const codeBlocks = container.querySelectorAll('pre > code');
      codeBlocks.forEach(code => {
        const wrapper = document.createElement('div');
        wrapper.className = 'code-block-wrapper';
        const pre = code.parentElement;
        pre.parentElement.insertBefore(wrapper, pre);
        wrapper.appendChild(pre);

        // Activate floating button when user interacts with this block
        const activate = () => setActiveWrapper(wrapper, code);
        wrapper.addEventListener('mouseenter', activate);
        wrapper.addEventListener('mousemove', activate);
        wrapper.addEventListener('touchstart', activate, {passive:true});
        wrapper.addEventListener('focusin', activate);

        // Reposition button when user scrolls this wrapper horizontally
        wrapper.addEventListener('scroll', positionFloatingBtn, {passive:true});
      });

      hljs.highlightAll();
      positionFloatingBtn(); // ensure placement if something is already hovered
    });
}

/* ------- Floating copy button logic ------- */
function setActiveWrapper(wrapper, codeEl) {
  if (activeWrapper !== wrapper) {
    activeWrapper = wrapper;
    activeCodeEl = codeEl;
  }
  positionFloatingBtn();
  showFloatingBtn();
}

function showFloatingBtn() {
  floatingBtn.classList.add('show');
}

function hideFloatingBtn() {
  floatingBtn.classList.remove('show');
  activeWrapper = null;
  activeCodeEl = null;
}

function positionFloatingBtn() {
  if (!activeWrapper) { hideFloatingBtn(); return; }

  const rect = activeWrapper.getBoundingClientRect();
  const btnRect = floatingBtn.getBoundingClientRect();
  const vw = window.innerWidth;
  const vh = window.innerHeight;

  // If wrapper not on screen, hide
  if (rect.bottom <= 0 || rect.top >= vh || rect.right <= 0 || rect.left >= vw) {
    hideFloatingBtn();
    return;
  }

  // Visible right edge is the min of wrapper right and viewport right
  const visibleRight = Math.min(rect.right, vw);
  // Visible top edge is the max of wrapper top and viewport top
  const visibleTop = Math.max(rect.top, 0);

  const left = Math.max(visibleRight - btnRect.width - 8, Math.max(rect.left + 8, 8));
  const top  = Math.min(
    Math.max(visibleTop + 8, 8),
    rect.bottom - btnRect.height - 8
  );

  floatingBtn.style.left = left + 'px';
  floatingBtn.style.top  = top + 'px';
  showFloatingBtn();
}

// Copy to clipboard
floatingBtn.addEventListener('click', () => {
  if (!activeCodeEl) return;
  const text = activeCodeEl.innerText;
  navigator.clipboard.writeText(text).then(() => {
    floatingBtn.classList.add('copied');
    const original = floatingBtn.textContent;
    floatingBtn.textContent = 'Copied!';
    clearTimeout(copyResetTimer);
    copyResetTimer = setTimeout(() => {
      floatingBtn.textContent = original;
      floatingBtn.classList.remove('copied');
    }, 1500);
  });
});

// Reposition on page scroll/resize
window.addEventListener('scroll', positionFloatingBtn, {passive:true});
window.addEventListener('resize', positionFloatingBtn);

/* ------- Dark mode ------- */
function setMode(isDark) {
  document.body.classList.toggle('dark-mode', isDark);
  hljsLight.disabled = isDark;
  hljsDark.disabled = !isDark;
  localStorage.setItem('mode', isDark ? 'dark' : 'light');
  document.getElementById('modeToggle').innerText = isDark ? 'Light Mode' : 'Dark Mode';
}
const savedMode = localStorage.getItem('mode');
setMode(savedMode === 'dark');
document.getElementById('modeToggle').addEventListener('click', () => {
  setMode(!document.body.classList.contains('dark-mode'));
});

/* ------- Mobile menu ------- */
function openMenu() {
  menuPopup.classList.add('open');
  menuOverlay.classList.add('active');
}
function closeMenu() {
  menuPopup.classList.remove('open');
  menuOverlay.classList.remove('active');
}
menuOverlay.addEventListener('click', closeMenu);

function updateMobileMenu() {
  mobileTabsContainer.innerHTML = '';
  document.querySelectorAll('header.topbar nav.topbar-nav a').forEach(a => {
    const mobileLink = document.createElement('a');
    mobileLink.href = a.href;
    mobileLink.innerText = a.innerText;
    mobileLink.className = a.className;
    mobileLink.onclick = e => {
      e.preventDefault();
      document.querySelectorAll('.topbar-nav a').forEach(tab => tab.classList.remove('active-tab'));
      a.classList.add('active-tab');
      closeMenu();
      const mdFile = a.getAttribute('data-md');
      if (mdFile) renderMarkdown(mdFile);
      else renderMarkdown('README.md');
    };
    mobileTabsContainer.appendChild(mobileLink);
  });
}

function addMobileToggle() {
  document.querySelectorAll('.nav-toggle-btn').forEach(el => el.remove());
  if (window.innerWidth <= 1000) {
    updateMobileMenu();
    const navBtn = document.createElement('button');
    navBtn.className = 'nav-toggle-btn';
    navBtn.textContent = 'â˜°';
    navBtn.onclick = openMenu;
    const topbar = document.querySelector('.topbar');
    topbar.insertBefore(navBtn, topbar.querySelector('.topbar-actions'));
  }
}
window.addEventListener('resize', addMobileToggle);
addMobileToggle();

/* ------- Navigation & initial load ------- */
document.getElementById('homeBtn').addEventListener('click', e => {
  e.preventDefault();
  document.querySelectorAll('.topbar-nav a').forEach(a => a.classList.remove('active-tab'));
  e.target.classList.add('active-tab');
  renderMarkdown('README.md');
});
document.querySelectorAll('.page-link').forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    document.querySelectorAll('.topbar-nav a').forEach(a => a.classList.remove('active-tab'));
    link.classList.add('active-tab');
    const mdFile = link.getAttribute('data-md');
    if (mdFile) renderMarkdown(mdFile);
  });
});

// Initial load
renderMarkdown('README.md');
</script>
</body>
</html>
